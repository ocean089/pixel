<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>å°å°å…µè²¼åœ°ç£š (æ”¹ç‰ˆ)</title>
  <style>
    /* æ•´é«”é é¢è¨­å®š */
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      background-color: #f0f8ff;
      margin: 0;
      padding: 20px;
      font-size: 18px; /* æ•´é«”å­—é«”æ”¾å¤§ */
    }
    h1 {
      color: #333;
      font-size: 28px; /* ä¸»æ¨™é¡Œæ›´å¤§ */
      margin-bottom: 10px;
    }

    /* é™åˆ¶æ•´å€‹ç¶²é æœ€å¤§å¯¬åº¦ */
    .page-wrapper {
      max-width: 768px;
      margin: 0 auto;
    }

    /* è¨ˆæ™‚å™¨(å³ä¸Šè§’) */
    #timer {
      position: fixed;
      top: 10px;
      right: 10px;
      font-size: 18px;
      color: #444;
      background-color: #fff;
      padding: 4px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      opacity: 0.9;
      z-index: 2000;
    }

    /* ä¸Šæ–¹å·¥å…·åˆ— */
    .top-controls {
      margin-bottom: 20px;
    }
    .top-controls label {
      font-size: 18px;
    }
    .top-controls select {
      font-size: 16px;
      padding: 5px;
    }
    .top-controls button {
      font-size: 16px;
      padding: 6px 12px;
      margin-left: 5px;
      cursor: pointer;
    }

    /* ä¸»å®¹å™¨ï¼šå·¦å´(é¡Œç›®) + å³å´(ç¶²æ ¼èˆ‡æ¨™ç¤º) */
    .container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      gap: 20px;
    }

    /* å·¦å´é¡Œç›® */
    .task-area {
      width: 260px; /* ç¨å¾®æ”¾å¤§ */
      text-align: left;
    }
    .task-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
    }
    .task-buttons button {
      padding: 10px 15px;
      font-size: 18px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      text-align: left;
    }
    .task-buttons button:hover {
      background-color: #0056b3;
    }
    .task-buttons button.active {
      background-color: red; /* ç›®å‰é¸æ“‡ä¸­çš„é¡Œç›®é¡¯ç¤ºç´…è‰² */
    }
    /* é¡Œç›®æ–‡å­—å­—é«”ã€è¡Œé«˜æ”¾å¤§ */
    #current-task {
      margin-top: 10px;
      background-color: #ffffff;
      padding: 10px;
      border: 1px solid #ccc;
      min-height: 120px;
      font-size: 20px;
      line-height: 1.8;
    }

    /* å³å´ï¼šå« row/col æ¨™ç¤º + çœŸæ­£çš„ç¶²æ ¼ */
    .grid-container {
      display: grid;
      grid-template-columns: auto 1fr;
      align-items: start;
    }
    .grid-row-label {
      display: grid;
    }
    .grid-row-label span {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: #333;
      border-right: 1px solid #aaa;
    }
    .grid-col-label {
      display: grid;
      justify-items: center;
      align-items: center;
      font-size: 18px;
      font-weight: bold;
      color: #333;
      margin-bottom: 0px;
    }
    .grid-col-label span {
      display: flex;
      justify-content: center;
      align-items: center;
      border-bottom: 1px solid #aaa;
    }

    /* ç¶²æ ¼æœ¬é«” */
    .grid {
      display: grid;
      border: 2px solid #000;
      margin: auto;
    }
    .cell {
      border: 1px solid #ccc;
      background-color: white;
    }
    .cell:hover {
      cursor: pointer;
      border: 1px solid #000;
    }

    /* è‰²ç›¤ */
    .color-picker-popup {
      display: none;
      position: absolute;
      background-color: #fff;
      border: 2px solid #000;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
      z-index: 100;
    }
    .color-picker-popup .color-button {
      margin: 5px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: inline-block;
      cursor: pointer;
    }
    .red    { background-color: red; }
    .yellow { background-color: yellow; }
    .black  { background-color: black; }
    .green  { background-color: green; }
    .blue   { background-color: blue; }
    .white  { background-color: white; border: 1px dashed #000; }

    /* å®Œæˆæç¤º(åŸæœ¬) */
    #completion-message {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: white;
      border: 2px solid #007BFF;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      color: green;
      z-index: 1000;
    }
    #completion-message button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      color: white;
      background-color: #007BFF;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #completion-message button:hover {
      background-color: #0056b3;
    }

    /* é¼“å‹µåœ–æ¡ˆå®¹å™¨(å®Œæˆæ™‚ä¸€èµ·é¡¯ç¤º)ï¼Œæ­¤è™•ç›´æ¥ä»¥ emoji æ–‡å­—åšç¤ºç¯„ */
    #encouragement-image {
      margin-top: 15px;
      font-size: 80px; /* èª¿æ•´ emoji å¤§å° */
      line-height: 1;
    }

    /* é€²åº¦æ¢èˆ‡æ•¸é‡æ–‡å­— */
    .progress-container {
      margin: 10px auto;
      width: 220px;
      height: 25px;
      border: 2px solid #666;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      background-color: #eee;
    }
    .progress-bar {
      height: 100%;
      width: 0%;
      background-color: #4caf50;
      transition: width 0.3s;
    }
    #progressText {
      margin: 5px auto;
      font-size: 18px;
      font-weight: bold;
      color: #333;
    }

    /* å³ä¸‹è§’ä½œè€…è³‡è¨Š */
    .author-info {
      position: fixed;
      right: 10px;
      bottom: 10px;
      font-size: 16px;
      color: #444;
      opacity: 0.7;
      background-color: #fff;
      padding: 4px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <!-- è¨ˆæ™‚å™¨ï¼ˆå³ä¸Šè§’ï¼‰ -->
  <div id="timer">å·²ä½¿ç”¨æ™‚é–“ï¼š0 ç§’</div>

  <div class="page-wrapper">
    <h1>å°å°å…µè²¼åœ°ç£š</h1>

    <!-- ä¸Šæ–¹å·¥å…· -->
    <div class="top-controls">
      <label for="grid-size">é¸æ“‡æ ¼å­å¤§å°:</label>
      <select id="grid-size">
        <option value="10" selected>10x10</option>
        <option value="15">15x15</option>
        <option value="20">20x20</option>
        <option value="25">25x25</option>
      </select>
      <button id="set-grid-size">è¨­å®šå¤§å°</button>
      <button id="clearButton">æ¸…é™¤æ‰€æœ‰æ ¼å­</button>
    </div>

    <div class="container">
      <!-- å·¦å´ï¼šé¡Œç›® -->
      <div class="task-area">
        <div class="task-buttons">
          <button id="è‡ªç”±ç™¼æ®" onclick="showTask('è‡ªç”±ç™¼æ®')">è‡ªç”±ç™¼æ®</button>
          <button id="ç¬¬ä¸€é¡Œ" onclick="showTask('ç¬¬ä¸€é¡Œ')">ç¬¬ä¸€é¡Œ</button>
          <button id="ç¬¬äºŒé¡Œ" onclick="showTask('ç¬¬äºŒé¡Œ')">ç¬¬äºŒé¡Œ</button>
          <button id="ç¬¬ä¸‰é¡Œ" onclick="showTask('ç¬¬ä¸‰é¡Œ')">ç¬¬ä¸‰é¡Œ</button>
          <button id="ç¬¬å››é¡Œ" onclick="showTask('ç¬¬å››é¡Œ')">ç¬¬å››é¡Œ</button>
        </div>
        <div id="current-task">è«‹é¸æ“‡é¡Œç›®</div>

        <!-- é€²åº¦æ–‡å­— + é€²åº¦æ¢ -->
        <div id="progressText">0 / 0</div>
        <div class="progress-container">
          <div id="progressBar" class="progress-bar"></div>
        </div>
      </div>

      <!-- å³å´ï¼šrow/col æ¨™ç±¤ + ç¶²æ ¼ -->
      <div class="grid-container">
        <div class="grid-row-label" id="row-label"></div>
        <div>
          <div class="grid-col-label" id="col-label"></div>
          <div class="grid" id="grid"></div>
        </div>
      </div>
    </div>

    <!-- è‰²ç›¤ -->
    <div id="popup" class="color-picker-popup">
      <div class="color-button red"    data-color="red"></div>
      <div class="color-button yellow" data-color="yellow"></div>
      <div class="color-button black"  data-color="black"></div>
      <div class="color-button green"  data-color="green"></div>
      <div class="color-button blue"   data-color="blue"></div>
      <div class="color-button white"  data-color="white"></div>
    </div>

    <!-- å®Œæˆæç¤º -->
    <div id="completion-message">
      å®Œæˆï¼æ­å–œä½ ï¼<br>
      <button onclick="closeCompletionMessage()">é—œé–‰</button>
      <!-- é¼“å‹µåœ–æ¡ˆ (å¤§å‹çš„è®šemoji) -->
      <div id="encouragement-image">ğŸ‘</div>
    </div>
  </div>

  <!-- å³ä¸‹è§’ä½œè€…è³‡è¨Š -->
  <div class="author-info">
    By popoyu ï½œé¡Œç›®åƒè€ƒè‡ªã€Œå¾éŠæˆ²ä¸­å­¸ç·¨ç¢¼ã€ç‹å•“ä»²ã€æŸ¯ä¸æ›¸ç±
  </div>

  <script>
    // ============== å…¨åŸŸè®Šæ•¸ ==============
    const grid              = document.getElementById('grid');
    const popup             = document.getElementById('popup');
    const completionMessage = document.getElementById('completion-message');
    const currentTaskDiv    = document.getElementById('current-task');
    const taskButtons       = document.querySelectorAll('.task-buttons button');
    const clearButton       = document.getElementById('clearButton');
    const gridSizeSelect    = document.getElementById('grid-size');
    const setGridSizeButton = document.getElementById('set-grid-size');
    const rowLabelContainer = document.getElementById('row-label');
    const colLabelContainer = document.getElementById('col-label');
    const progressText      = document.getElementById('progressText');
    const progressBar       = document.getElementById('progressBar');
    const timerDiv          = document.getElementById('timer');

    // è¨ˆæ™‚ç›¸é—œ
    let timeElapsed    = 0;   // å·²ç”¨ç§’æ•¸
    let timerInterval  = null;
    let isCompleted    = false; // æ˜¯å¦å·²ç¶“å®Œæˆ

    // æ³¨éŸ³ç¬¦è™Ÿï¼ˆæœ€å¤š25å€‹å°æ‡‰25Ã—25ï¼‰
    const zhuyinLabels = [
      "ã„…","ã„†","ã„‡","ã„ˆ","ã„‰","ã„Š","ã„‹","ã„Œ","ã„",
      "ã„","ã„","ã„","ã„‘","ã„’","ã„“","ã„”","ã„•","ã„–","ã„—","ã„˜","ã„™",
      "ã„š","ã„›","ã„œ","ã„"
    ];

    // é¡Œç›®å®šç¾©
    const tasks = {
      'è‡ªç”±ç™¼æ®': {
        text: 'è‡ªç”±ç™¼æ®ï¼šè«‹è‡ªç”±å‰µä½œï¼',
        cells: {}
      },
      'ç¬¬ä¸€é¡Œ': {
        text: `
          <span style="color: red;">ç´…è‰²</span>ï¼šã„‡-2ï¼Œã„‡-4ï¼Œã„ˆ-1ï¼Œã„ˆ-3ï¼Œã„ˆ-5<br>
          <span style="color: black;">é»‘è‰²</span>ï¼šã„‹-3<br>
          <span style="color: green;">ç¶ è‰²</span>ï¼šã„‰-1ï¼Œã„‰-5ï¼Œã„Š-2ï¼Œã„Š-4
        `,
        cells: {
          'ã„‡-2': 'red',
          'ã„‡-4': 'red',
          'ã„ˆ-1': 'red',
          'ã„ˆ-3': 'red',
          'ã„ˆ-5': 'red',
          'ã„‹-3': 'black',
          'ã„‰-1': 'green',
          'ã„‰-5': 'green',
          'ã„Š-2': 'green',
          'ã„Š-4': 'green'
        }
      },
      'ç¬¬äºŒé¡Œ': {
        text: `
          <span style="color: red;">ç´…è‰²</span>: ã„‰-2, ã„Š-2, ã„Š-4, ã„‹-3<br>
          <span style="background-color: black; color: yellow;">é»ƒè‰²</span>: ã„…-4, ã„†-4, ã„†-5, ã„‡-4, ã„‡-6<br>
          <span style="color: blue;">è—è‰²</span>: ã„ˆ-3, ã„ˆ-4, ã„‰-3, ã„‰-4, ã„Š-3
        `,
        cells: {
          'ã„‰-2': 'red', 'ã„Š-2': 'red', 'ã„Š-4': 'red', 'ã„‹-3': 'red',
          'ã„…-4': 'yellow', 'ã„†-4': 'yellow', 'ã„†-5': 'yellow', 'ã„‡-4': 'yellow', 'ã„‡-6': 'yellow',
          'ã„ˆ-3': 'blue', 'ã„ˆ-4': 'blue', 'ã„‰-3': 'blue', 'ã„‰-4': 'blue', 'ã„Š-3': 'blue'
        }
      },
      'ç¬¬ä¸‰é¡Œ': {
        text: `
          <span style="color: red;">ç´…è‰²</span>: ã„…-2ï¼Œã„†-1ï¼Œã„†-3ï¼Œã„‡-3ï¼Œã„ˆ-3<br>
          <span style="color: black;">é»‘è‰²</span>: ã„†-2ï¼Œã„‹-3ï¼Œã„‹-6ï¼Œã„Œ-3ï¼Œã„Œ-6<br>
          <span style="color: green;">ç¶ è‰²</span>: ã„‰-5ï¼Œã„‰-6ï¼Œã„Š-6<br>
          <span style="background-color: black; color: yellow;">é»ƒè‰²</span>: ã„‰-3ï¼Œã„‰-4ï¼Œã„Š-3ï¼Œã„Š-4ï¼Œã„Š-5
        `,
        cells: {
          'ã„…-2': 'red', 'ã„†-1': 'red', 'ã„†-3': 'red', 'ã„‡-3': 'red', 'ã„ˆ-3': 'red',
          'ã„†-2': 'black', 'ã„‹-3': 'black', 'ã„‹-6': 'black', 'ã„Œ-3': 'black', 'ã„Œ-6': 'black',
          'ã„‰-5': 'green', 'ã„‰-6': 'green', 'ã„Š-6': 'green',
          'ã„‰-3': 'yellow', 'ã„‰-4': 'yellow', 'ã„Š-3': 'yellow', 'ã„Š-4': 'yellow', 'ã„Š-5': 'yellow'
        }
      },
      'ç¬¬å››é¡Œ': {
        text: `
          <span style="color: red;">ç´…è‰²</span>: ã„‡-2ï¼Œã„‡-4ï¼Œã„‰-2ï¼Œã„‰-4<br>
          <span style="color: blue;">è—è‰²</span>: ã„ˆ-3ï¼Œã„Š-3ï¼Œã„‹-3ï¼Œã„Œ-3<br>
          <span style="color: green;">ç¶ è‰²</span>: ã„Š-6ï¼Œã„‹-1ï¼Œã„‹-5ï¼Œã„Œ-2ï¼Œã„Œ-4<br>
          <span style="background-color: black; color: yellow;">é»ƒè‰²</span>: ã„‡-3ï¼Œã„ˆ-2ï¼Œã„ˆ-4ï¼Œã„‰-3
        `,
        cells: {
          'ã„‡-2': 'red', 'ã„‡-4': 'red', 'ã„‰-2': 'red', 'ã„‰-4': 'red',
          'ã„ˆ-3': 'blue', 'ã„Š-3': 'blue', 'ã„‹-3': 'blue', 'ã„Œ-3': 'blue',
          'ã„Š-6': 'green', 'ã„‹-1': 'green', 'ã„‹-5': 'green', 'ã„Œ-2': 'green', 'ã„Œ-4': 'green',
          'ã„‡-3': 'yellow', 'ã„ˆ-2': 'yellow', 'ã„ˆ-4': 'yellow', 'ã„‰-3': 'yellow'
        }
      }
    };

    // ä¿ç•™é€™å…©å€‹è¨ˆæ•¸å™¨ç”¨ä¾†æ›´æ–°é€²åº¦æ¢
    let completedCount = 0;
    let totalRequired  = 0;

    // ç‚ºäº†è¨˜éŒ„ç›®å‰é¸åˆ°å“ªå€‹é¡Œç›®
    let currentTaskName = '';

    // ç”¨ä¾†å„²å­˜ã€Œæ¯å€‹æ ¼å­ã€çš„ç›®å‰é¡è‰² (äºŒç¶­é™£åˆ—)
    let cellColors = [];

    // ç”¨ä¾†æš«å­˜è¢«é»æ“Šçš„ cell
    let selectedCell = null;

    // ============== é è¨­å»ºç«‹ 10Ã—10 + åˆå§‹åŒ– ==============
    createGrid(10);
    // é é¢è¼‰å…¥å¾Œå°±é–‹å§‹è¨ˆæ™‚
    startTimer();

    // ============== å»ºç«‹ç¶²æ ¼ + row/colæ¨™ç±¤ ==============
    function createGrid(size) {
      // 1) å…ˆæ¸…ç©ºç•«é¢
      rowLabelContainer.innerHTML = '';
      colLabelContainer.innerHTML = '';
      grid.innerHTML = '';

      // 2) åˆå§‹åŒ– cellColors (äºŒç¶­ï¼Œé è¨­å…¨éƒ¨ white)
      cellColors = Array.from({ length: size }, () =>
        Array.from({ length: size }, () => 'white')
      );

      // 3) æ ¹æ“š size è¨ˆç®— cellSize
      const cellSize = getCellSize(size);

      // 4) å‹•æ…‹è¨­å®š row-label (æœ€ä¸Šæ–¹ç©ºç™½ + sizeè¡Œ)
      rowLabelContainer.style.gridTemplateRows =
        `40px repeat(${size}, ${cellSize}px)`;

      // col-label
      colLabelContainer.style.gridTemplateColumns =
        `repeat(${size}, ${cellSize}px)`;

      const blankSpan = document.createElement('span');
      blankSpan.textContent = '';
      blankSpan.style.height = "40px";
      rowLabelContainer.appendChild(blankSpan);

      for (let r = 0; r < size; r++) {
        const span = document.createElement('span');
        span.textContent = zhuyinLabels[r] || '?';
        span.style.width  = cellSize + "px";
        span.style.height = cellSize + "px";
        rowLabelContainer.appendChild(span);
      }

      // 5) å»ºç«‹ col æ¨™ç±¤(1 ~ size)
      for (let c = 0; c < size; c++) {
        const span = document.createElement('span');
        span.textContent = c+1;
        span.style.width  = cellSize + "px";
        span.style.height = "40px";
        colLabelContainer.appendChild(span);
      }

      // 6) è¨­å®š grid (sizeÃ—size)
      grid.style.gridTemplateColumns = `repeat(${size}, ${cellSize}px)`;
      grid.style.gridTemplateRows    = `repeat(${size}, ${cellSize}px)`;

      // 7) ç”Ÿæˆ cells
      for (let row = 0; row < size; row++) {
        for (let col = 0; col < size; col++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          cell.style.width  = cellSize + "px";
          cell.style.height = cellSize + "px";
          cell.dataset.row = row;
          cell.dataset.col = col;

          // é»æ“Šæ ¼å­ => å½ˆå‡ºè‰²ç›¤
          cell.addEventListener('click', (event) => {
            event.stopPropagation();
            selectedCell = cell;
            const rect = cell.getBoundingClientRect();
            popup.style.display = 'block';
            popup.style.top  = `${rect.top + window.scrollY + rect.height}px`;
            popup.style.left = `${rect.left + window.scrollX}px`;
          });

          grid.appendChild(cell);
        }
      }
    }

    // ============== ä¾ç…§ä¸åŒ size è¨ˆç®—æ¯æ ¼åƒç´ å¤§å° ==============
    function getCellSize(size) {
      if (size <= 10) return 50;
      else if (size <= 15) return 40;
      else if (size <= 20) return 30;
      else return 25;
    }

    // ============== é»æ“Šè‰²ç›¤é¸è‰²ï¼Œæ›´æ–° cellColors + é‡æ–°è¨ˆç®—é¡Œç›®é€²åº¦ ==============
    popup.addEventListener('click', (event) => {
      if (event.target.classList.contains('color-button')) {
        const color = event.target.dataset.color;
        if (selectedCell) {
          const rowIndex = parseInt(selectedCell.dataset.row);
          const colIndex = parseInt(selectedCell.dataset.col);

          // 1) æ›´æ–° cellColors
          cellColors[rowIndex][colIndex] = color;

          // 2) æ›´æ–°æ ¼å­èƒŒæ™¯
          selectedCell.style.backgroundColor = color;

          // 3) é‡æ–°è¨ˆç®—ç•¶å‰é¡Œç›®å®Œæˆåº¦ + æ›´æ–°æ–‡å­—
          updateProgressAndTaskText();
        }
        popup.style.display = 'none';
      }
    });

    // ============== é€²åº¦æ¢æ›´æ–° ==============
    function updateProgressBar() {
      progressText.textContent = `${completedCount} / ${totalRequired}`;
      let percent = 0;
      if (totalRequired > 0) {
        percent = (completedCount / totalRequired) * 100;
      }
      progressBar.style.width = percent + '%';
    }

    // ============== åˆ‡æ›é¡Œç›® ==============
    function showTask(taskName) {
      // 1) UIä¸Šçš„æŒ‰éˆ•ç‹€æ…‹
      taskButtons.forEach(btn => btn.classList.remove('active'));
      document.getElementById(taskName).classList.add('active');

      // 2) æ›´æ–°å…¨åŸŸè®Šæ•¸
      currentTaskName = taskName;

      // 3) é¡¯ç¤ºè©²é¡Œç›®çš„èªªæ˜
      currentTaskDiv.innerHTML = tasks[taskName].text;

      // 4) é‡æ–°è¨ˆç®—å®Œæˆåº¦ï¼Œä¸¦æ›´æ–°æ–‡å­—é¡¯ç¤º
      updateProgressAndTaskText();
    }

    // ============== æ ¸å¿ƒï¼šå‹•æ…‹è¨ˆç®—å“ªäº›æ ¼å­é¡è‰²æ­£ç¢ºï¼Œæ›´æ–°é€²åº¦èˆ‡æ–‡å­— ==============
    function updateProgressAndTaskText() {
      // å¦‚æœé‚„æ²’é¸é¡Œç›®ï¼Œå°±ä¸ç”¨åš
      if (!currentTaskName) return;

      const taskObj = tasks[currentTaskName];
      const requiredMap = taskObj.cells;  // { 'ã„‡-2': 'red', 'ã„‡-4': 'red', ... }
      const total = Object.keys(requiredMap).length;

      // 1) è¨ˆç®—å®Œæˆåº¦
      let correctCount = 0;
      Object.entries(requiredMap).forEach(([label, requiredColor]) => {
        const { row, col } = parseLabel(label);
        if (
          cellColors[row] &&
          cellColors[row][col] === requiredColor
        ) {
          correctCount++;
        }
      });

      completedCount = correctCount;
      totalRequired  = total;

      // 2) ç”¢ç”Ÿæ–°çš„é¡Œç›®æ–‡å­— (æŠŠã€Œæ­£ç¢ºã€çš„ label é¡¯ç¤ºç°è‰² + åˆªé™¤ç·š)
      let newHTML = taskObj.text;
      Object.entries(requiredMap).forEach(([label, requiredColor]) => {
        const { row, col } = parseLabel(label);
        if (cellColors[row] && cellColors[row][col] === requiredColor) {
          newHTML = newHTML.replace(
            new RegExp(label, 'g'),
            `<span style="color: gray; text-decoration: line-through;">${label}</span>`
          );
        }
      });
      currentTaskDiv.innerHTML = newHTML;

      // 3) æ›´æ–°é€²åº¦æ¢
      updateProgressBar();

      // 4) å¦‚æœå…¨éƒ¨å®Œæˆ => é¡¯ç¤ºå®Œæˆæç¤º + åœæ­¢è¨ˆæ™‚
      if (correctCount === total && total > 0) {
        isCompleted = true; // è¡¨ç¤ºå·²å®Œæˆ
        completionMessage.style.display = 'block';
        stopTimer(); // åœæ­¢è¨ˆæ™‚
      } else {
        completionMessage.style.display = 'none';
      }
    }

    // ============== å·¥å…·ï¼šæŠŠ 'ã„‡-2' è½‰æˆ row=2, col=1 ==============
    function parseLabel(label) {
      const [zhuyin, numString] = label.split('-');
      const row = zhuyinLabels.indexOf(zhuyin);
      const col = parseInt(numString, 10) - 1;
      return { row, col };
    }

    // ============== é»æ“Šåˆ¥è™•é—œé–‰è‰²ç›¤ ==============
    document.addEventListener('click', (event) => {
      if (!popup.contains(event.target)) {
        popup.style.display = 'none';
      }
    });

    // ============== ã€Œè¨­å®šå¤§å°ã€æŒ‰éˆ• ==============
    setGridSizeButton.addEventListener('click', () => {
      const size = parseInt(gridSizeSelect.value);
      createGrid(size);
      // åˆ‡æ›åˆ°æ–°ç¶²æ ¼å¾Œï¼Œå¦‚æœæœ‰é¸é¡Œç›®ï¼Œå°±é‡ç®—
      updateProgressAndTaskText();
      completionMessage.style.display = 'none';
      isCompleted = false;
      // é‡ç½®ä¸¦é‡æ–°é–‹å§‹è¨ˆæ™‚
      resetTimer();
      startTimer();
    });

    // ============== ã€Œæ¸…é™¤æ‰€æœ‰æ ¼å­ã€æŒ‰éˆ• ==============
    clearButton.addEventListener('click', () => {
      document.querySelectorAll('.cell').forEach(cell => {
        cell.style.backgroundColor = 'white';
      });
      // cellColors ä¹Ÿå…¨éƒ¨é‚„åŸ
      cellColors.forEach((rowArr) => rowArr.fill('white'));

      completionMessage.style.display = 'none';
      isCompleted = false;
      // é‡ç®—
      updateProgressAndTaskText();
      // é‡æ–°é–‹å§‹è¨ˆæ™‚
      resetTimer();
      startTimer();
    });

    // ============== é—œé–‰å®Œæˆæç¤º ==============
    function closeCompletionMessage() {
      completionMessage.style.display = 'none';
    }

    // ============== è¨ˆæ™‚å™¨ç›¸é—œï¼šé–‹å§‹/åœæ­¢/é‡ç½® ==============
    function startTimer() {
      // è‹¥å·²ç¶“å®Œæˆï¼Œå°±ä¸è¦å†é–‹å•Ÿè¨ˆæ™‚
      if (isCompleted) return;
      timerInterval = setInterval(() => {
        timeElapsed++;
        timerDiv.textContent = `å·²ä½¿ç”¨æ™‚é–“ï¼š${timeElapsed} ç§’`;
      }, 1000);
    }
    function stopTimer() {
      clearInterval(timerInterval);
      timerInterval = null;
    }
    function resetTimer() {
      stopTimer();
      timeElapsed = 0;
      timerDiv.textContent = `å·²ä½¿ç”¨æ™‚é–“ï¼š0 ç§’`;
    }
  </script>
</body>
</html>
