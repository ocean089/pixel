// 修正滑動異常：只允許單格移動，避免偏移跳躍
function drag(e) {
  if (!dragging) return;
  const currentX = dragging.x;
  const currentY = dragging.y;
  const targetX = Math.round((e.clientX - board.getBoundingClientRect().left - offsetX) / CELL_SIZE);
  const targetY = Math.round((e.clientY - board.getBoundingClientRect().top - offsetY) / CELL_SIZE);
  const dx = targetX - currentX;
  const dy = targetY - currentY;

  // 限制只移動一格
  if (Math.abs(dx) + Math.abs(dy) !== 1) return;
  if (tryMove(dragging, targetX, targetY)) {
    steps++;
    updateStepCount();
    createBlocks();
    checkVictory();
  }
}

function touchMove(e) {
  e.preventDefault();
  if (!dragging) return;
  const touch = e.touches[0];
  const currentX = dragging.x;
  const currentY = dragging.y;
  const targetX = Math.round((touch.clientX - board.getBoundingClientRect().left - offsetX) / CELL_SIZE);
  const targetY = Math.round((touch.clientY - board.getBoundingClientRect().top - offsetY) / CELL_SIZE);
  const dx = targetX - currentX;
  const dy = targetY - currentY;

  // 限制只移動一格
  if (Math.abs(dx) + Math.abs(dy) !== 1) return;
  if (tryMove(dragging, targetX, targetY)) {
    steps++;
    updateStepCount();
    createBlocks();
    checkVictory();
  }
}
